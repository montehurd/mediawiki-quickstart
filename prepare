#!/bin/bash

source "./config"

prepare() {
  local extra_compose_file_path
  extra_compose_file_path=${1:-""}
  mkdir -p "$MEDIAWIKI_PATH"
  cd "$MEDIAWIKI_PATH" || exit
  if ! git clone https://gerrit.wikimedia.org/r/mediawiki/core.git . --depth=1; then
    echo "Failed to clone MediaWiki. Exiting."
    exit 1
  fi
  echo "$MW_ENV" >.env
  cp "$SCRIPT_PATH/docker-compose.override.yml" . || true
  if [ -n "$extra_compose_file_path" ] && [ -f "$extra_compose_file_path" ]; then
    cp "$extra_compose_file_path" .
  fi
}

if [[ "$0" == "${BASH_SOURCE[0]}" ]]; then
  prepare "$@"
fi
