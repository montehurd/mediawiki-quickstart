#!/bin/bash

source "./config"
source "./common/utility.sh"

prepare() {
  mkdir -p "$MEDIAWIKI_PATH"
  local clone_depth="--depth=${CLONE_DEPTH:-2}"
  if [ "${CLONE_DEPTH:-1}" -eq 0 ]; then
    local clone_depth=""
  fi
  if ! clone_git_repo "$GIT_CLONE_BASE_URL/core.git" "$MEDIAWIKI_PATH"; then
    echo "Failed to clone MediaWiki. Exiting."
    exit 1
  fi
  echo -e "" > "$SCRIPT_PATH/common/docker-compose.components.yml"
  echo "$MW_ENV" >.env
}

if [[ "$0" == "${BASH_SOURCE[0]}" ]]; then
  prepare "$@"
fi