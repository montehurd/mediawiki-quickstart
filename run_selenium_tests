#!/bin/bash

source "./selenium/selenium.sh"
source "./common/utility.sh"

run_selenium_tests() {
  ensure_selenium_ready || exit 1

  local component_path=""
  # Only use first arg as component path if it doesn't start with --
  if [[ $# -gt 0 && ! "$1" =~ ^-- ]]; then
    component_path="$1"
  fi

  ./shellto \
    $([[ "${SILENT:-0}" == "1" ]] || echo "-it") \
    -e NODE_OPTIONS="--require /var/local/wdio-arg-injector.js" \
    -e WDIO_INJECTION_ARGS="$(printf '%s\0' "$@" | base64 -w0)" \
    -w "/var/www/html/w/${component_path}" \
    s bash -c '
      [ -f /var/www/html/w/.env ] && source /var/www/html/w/.env
      export CHROME_PATH
      npm run selenium-test
    '
}

if [[ "$0" == "${BASH_SOURCE[0]}" ]]; then
  run_selenium_tests "$@"
fi