#!/bin/bash

source "./common/utility.sh"

if [ -z "$1" ]; then
    echo "Error: No dump file specified"
    echo "Usage: $0 <path-to-dump-file>"
    exit 1
fi

DUMP_FILE=$1

if [ ! -f "$DUMP_FILE" ]; then
    echo "Error: Dump file $DUMP_FILE not found"
    exit 1
fi

# Copy dump file into container
docker compose cp "$DUMP_FILE" mysql:/tmp/dump.sql.gz

# Restore from within the container
./shellto mysql bash -c "gunzip < /tmp/dump.sql.gz | mysql --user=root" 2>&1 | verboseOrDotPerLine "Restoring from MySQL dump"

# Remove temp file
./shellto mysql bash -c "rm -f /tmp/dump.sql.gz" 2>&1

docker compose restart mysql  2>&1 | verboseOrDotPerLine "Restarting MySQL container"