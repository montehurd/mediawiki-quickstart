#!/bin/bash

source "./config"
source "./common/utility.sh"
source "./docker/docker-compose-wrapper.sh"

remove() {
  if [ ! -d "$MEDIAWIKI_PATH" ]; then
    return
  fi
  if ! confirm_action "Are you sure you want to delete mediawiki containers and EVERYTHING in \"$MEDIAWIKI_PATH\""; then
    exit 1
  fi
  if is_container_running "mediawiki-mediawiki-1"; then
    docker exec -u root mediawiki-mediawiki-1 sh -c "[ -d node_modules ] && rm -rf node_modules"
  fi
  if [ -f "$MEDIAWIKI_PATH/docker-compose.yml" ]; then
    docker_compose down
  fi
  if [ -n "$MEDIAWIKI_PATH" ] && [ -d "$MEDIAWIKI_PATH" ]; then
    rm -rf "$MEDIAWIKI_PATH"
  fi
}

if [[ "$0" == "${BASH_SOURCE[0]}" ]]; then
  remove "$@"
fi
